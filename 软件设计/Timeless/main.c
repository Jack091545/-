#include "stc12c5a60s2.h"
#include "Display.h"
#include "DS1302.h"
#include "UART.h"
#include "Timer.h"
#include <intrins.h> 
#include <stdio.h>


unsigned char code number[10][8]={
{0x00,0x38,0x6C,0x6C,0x6C,0x6C,0x6C,0x38},/*"0",0*/

{0x00,0x18,0x1C,0x18,0x18,0x18,0x18,0x3C},/*"1",1*/

{0x00,0x38,0x6C,0x60,0x30,0x18,0x0C,0x7C},/*"2",2*/

{0x00,0x38,0x6C,0x60,0x38,0x60,0x6C,0x38},/*"3",3*/

{0x00,0x30,0x38,0x38,0x3C,0x3C,0x7C,0x30},/*"4",4*/

{0x00,0x7C,0x0C,0x0C,0x3C,0x60,0x60,0x3C},/*"5",5*/

{0x00,0x38,0x6C,0x0C,0x3C,0x6C,0x6C,0x38},/*"6",6*/

{0x00,0x7C,0x6C,0x60,0x30,0x18,0x18,0x18},/*"7",7*/

{0x00,0x38,0x6C,0x6C,0x38,0x6C,0x6C,0x38},/*"8",8*/

{0x00,0x38,0x6C,0x6C,0x78,0x60,0x6C,0x38}/*"9",9*/
};

unsigned char code lift_num[10][8]= {
{0x7C,0xFE,0x82,0xFE,0x7C,0x00,0x00,0x00},/*"0",0*/

{0x00,0x80,0xFE,0xFE,0x84,0x00,0x00,0x00},/*"1",1*/

{0x8C,0x9E,0xB2,0xE6,0xC4,0x00,0x00,0x00},/*"2",2*/

{0x6C,0xFE,0x92,0xD6,0x44,0x00,0x00,0x00},/*"3",3*/

{0x20,0xFE,0xFE,0x24,0x38,0x00,0x00,0x00},/*"4",4*/

{0x62,0xF2,0x92,0x9E,0x9E,0x00,0x00,0x00},/*"5",5*/

{0x64,0xF6,0x92,0xFE,0x7C,0x00,0x00,0x00},/*"6",6*/

{0x0E,0x1E,0xF2,0xE6,0x06,0x00,0x00,0x00},/*"7",7*/

{0x6C,0xFE,0x92,0xFE,0x6C,0x00,0x00,0x00},/*"8",8*/

{0x7C,0xFE,0x92,0xDE,0x4C,0x00,0x00,0x00}/*"9",9*/
};
unsigned char code lift_num_dot[10][8] = {
{0x6c,0x00,0x7C,0xFE,0x82,0xFE,0x7C,0x00},/*"0",0*/

{0x6c,0x00,0x00,0x80,0xFE,0xFE,0x84,0x00},/*"1",0*/

{0x6c,0x00,0x8C,0x9E,0xB2,0xE6,0xC4,0x00},/*"2",2*/

{0x6c,0x00,0x6C,0xFE,0x92,0xD6,0x44,0x00},/*"3",3*/

{0x6c,0x00,0x20,0xFE,0xFE,0x24,0x38,0x00},/*"4",4*/

{0x6c,0x00,0x62,0xF2,0x92,0x9E,0x9E,0x00},/*"5",5*/

{0x6c,0x00,0x64,0xF6,0x92,0xFE,0x7C,0x00},/*"6",6*/

{0x6c,0x00,0x0E,0x1E,0xF2,0xE6,0x06,0x00},/*"7",7*/

{0x6c,0x00,0x6C,0xFE,0x92,0xFE,0x6C,0x00},/*"8",8*/

{0x6c,0x00,0x7C,0xFE,0x92,0xDE,0x4C,0x00}/*"9",9*/
};
unsigned char code right_num_dot[10][8] = {
{0x00,0x7C,0xFE,0x82,0xFE,0x7C,0x00,0x6c},/*"0",0*/

{0x00,0x80,0xFE,0xFE,0x84,0x00,0x00,0x6c},/*"1",0*/

{0x00,0x8C,0x9E,0xB2,0xE6,0xC4,0x00,0x6c},/*"2",2*/

{0x00,0x6C,0xFE,0x92,0xD6,0x44,0x00,0x6c},/*"3",3*/

{0x00,0x20,0xFE,0xFE,0x24,0x38,0x00,0x6C},/*"4",4*/

{0x00,0x62,0xF2,0x92,0x9E,0x9E,0x00,0x6c},/*"5",5*/

{0x00,0x64,0xF6,0x92,0xFE,0x7C,0x00,0x6c},/*"6",6*/

{0x00,0x0E,0x1E,0xF2,0xE6,0x06,0x00,0x6c},/*"7",7*/

{0x00,0x6C,0xFE,0x92,0xFE,0x6C,0x00,0x6c},/*"8",8*/

{0x00,0x7C,0xFE,0x92,0xDE,0x4C,0x00,0x6c}/*"9",9*/

};
unsigned char code right_num[10][8] = {
{0x00,0x00,0x00,0x7C,0xFE,0x82,0xFE,0x7C},/*"0",0*/

{0x00,0x00,0x00,0x00,0x80,0xFE,0xFE,0x84},/*"1",1*/

{0x00,0x00,0x00,0x8C,0x9E,0xB2,0xE6,0xC4},/*"2",2*/

{0x00,0x00,0x00,0x6C,0xFE,0x92,0xD6,0x44},/*"3",3*/

{0x00,0x00,0x00,0x20,0xFE,0xFE,0x24,0x38},/*"4",4*/

{0x00,0x00,0x00,0x62,0xF2,0x92,0x9E,0x9E},/*"5",5*/

{0x00,0x00,0x00,0x64,0xF6,0x92,0xFE,0x7C},/*"6",6*/

{0x00,0x00,0x00,0x0E,0x1E,0xF2,0xE6,0x06},/*"7",7*/

{0x00,0x00,0x00,0x6C,0xFE,0x92,0xFE,0x6C},/*"8",8*/

{0x00,0x00,0x00,0x7C,0xFE,0x92,0xDE,0x4C}/*"9",9*/
};

sbit LED = P1^4;
extern unsigned int nian,yue,ri,shi,fen,miao,zhou;

/*------------------------------------------------
                   主程序
------------------------------------------------*/
void main(void)
{
	LED = 1;
	Ds1302_Init();
//	Ds1302_Write_Time();
//	DelayMs(100);
	Timer0_Init();
//	DelayMs(100);
	UART_Init();
	EA = 1;	
//	DelayMs(100);
	Ds1302_Read_Time();   //首次读取时间
//	DelayMs(100);
	SendStr("Timeless V1.0\n");
	while(1)
	{
		Ds1302_Read_Time();
		shi=(int)time_buf1[4];//时			//数据的转换，因我们采用数码管0~9的显示,将数据分开							    	        //加入"-"
		fen=(int)time_buf1[5];//分
		miao=(int)time_buf1[6];//秒	
		nian=(int)time_buf1[1];//年									    
		yue=(int)time_buf1[2];//月
		ri=(int)time_buf1[3];//日	
		zhou=(int)time_buf1[7];//周
		Send_Data(&lift_num[shi/10][0],&lift_num_dot[shi%10][0],&right_num_dot[fen/10][0],&right_num[fen%10][0]);
	}
}


/*------------------------------------------------
                  串口中断程序
------------------------------------------------*/
void UART_SER (void) interrupt 4 //串行中断服务程序
{
    unsigned char Temp;          //定义临时变量 

    if(RI)                        //判断是接收中断产生
     {
	  RI=0;                      //标志位清零
	  Temp=SBUF;                 //读入缓冲区的值
      SBUF=Temp; //把接收到的值再发回电脑端
	 }
//   if(TI)  //如果是发送标志位，清零
//     TI=0;
} 